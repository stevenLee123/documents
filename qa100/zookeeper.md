## zookeeper 
基于观察者模式的分布式服务管理框架，负责管理需要关心的数据，接受观察者的注册，一旦这些数据的状态发生变化，zk将负责通知已经在zk上注册的哪些观察者做出相应的反应
主要用来做分布式应用的协同开发工作
保障系统的最终一致性、有序性、持久性

## zk的特点
* 最终一致性：为客户段展示同一视图
* 可靠性：消息被一条服务器接受，则它将被所有服务器接受
* 实时性：
* 等待无关性
* 原子性：数据更新状态只能成功或者失败，没有中间状态
* 顺序性：所有server，同一消息发布顺序一致

## zk的数据结构
zk的数据模型结构与unix文件系统很像，整体可以看作是树，每个节点为Znode，每个Znode默认能存储1MB数据，每个Znode可以通过路径唯一标识

## zk的写数据流程
1. 客户端发送鞋请求到zk服务器1
2. zk服务器发送请求到leader，leader重新发送数据到集群内的所有服务器进行投票
3. leader收集投票信息确定数据写入结果
4. 接收客户端请求的服务器响应最终操作结果给客户端

## zk的四种节点
* PERSISTENT 无序永久节点
* PERSISTENT_SEQUENTIAL 有序永久节点
* EPHEMERAL 无序临时节点
* EPHEMERAL_SEQUENTIAL 有序临时节点

## zk的应用场景
* 统一命名服务：分布式环境下对应用的服务进行统一命名，便于识别，例如使用域名代替IP
* 配置管理：在hadoop中保证每个zk节点上获取到的配置数据是一致的
* 集群管理：分布式环境中，实时掌握每个节点的状态是必要的
* 分布式锁：多个客户端同时在zk上创建相同的znode，只有一个会创建成功；创建成功的客户端得到锁，其他客户端等待
* 分布式队列：

## zk集群搭建
端口号说明：
2181: 对client段提供服务
3888: 选举leader使用
2888: 集群内机器通讯使用（Leader监听此端口）


## API
./bin/zkCli.sh -server 127.0.0.1:2181,127.0.0.1:2182,127.0.0.1:2183 连接集群

create /path data 创建一个名为/path的znode节点，包含数据data

delete /path 删除名为/path的 znode

exists /path 检查是否存在名为/path的节点

set /path data 设置名为/path 的znode数据为data

get /path 返回名为path的数据节点信息

getChildren /path 返回所有/path节点的所有自节点列表

stat /path 查询节点状态



## watcher通知机制
客户端像zk注册需要接受通知的znode，通过znode设置监视点来接受通知，监视点是一个单次触发的操作,对于每次数据变更接收到变更数据后，需要重新进行监视